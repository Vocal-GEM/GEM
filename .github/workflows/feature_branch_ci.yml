name: Feature Branch CI/QA (Claude)

# This workflow is triggered on a Pull Request.
on:
  pull_request:
    types: [opened, synchronize, reopened]
    # Only run this workflow when the PR is opened against the 'develop' branch
    branches:
      - develop

jobs:
  # This job represents the "Claude Codex" agent's automated work
  claude_qa_agent:
    runs-on: ubuntu-latest
    
    # We use 'name' to clearly label this agent's task in the GitHub UI
    name: ðŸ§ª Claude Codex - Automated Testing

    steps:
      - name: Checkout Code
        # This step checks out the code from the feature branch linked to the PR
        uses: actions/checkout@v4

      - name: Setup Project Environment (Node.js)
        # Change this to match the language of your project (e.g., Node.js, Ruby)
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci

      - name: Run Tests (The Claude Agent's Task)
        id: run_tests
        # This is where Claude's task (running tests) is automated.
        # This command must execute your project's test suite (e.g., pytest, jest).
        run: |
          echo "Claude Codex is now running tests on branch ${{ github.head_ref }}"
          npm test

      # Optional: Create a Summary/Report (to mimic Claude's report)
      - name: Generate Summary Report
        if: always() # Run even if tests fail
        run: |
          echo "### ðŸ§ª QA Report by Claude Codex" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.run_tests.outcome }}" == "success" ]; then
            echo "âœ… All tests passed. Code is ready for human review." >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ Tests failed! See logs for details. **Gemini 3 must fix the failing tests.**" >> $GITHUB_STEP_SUMMARY
          fi

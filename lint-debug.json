[{"filePath":"C:\\Users\\riley\\Desktop\\GEM\\src\\components\\ui\\CommandPalette.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'useCallback' is not defined.","line":105,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":105,"endColumn":37}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport { Search, Command, ArrowRight, Mic, Activity, Book, Settings, LayoutGrid } from 'lucide-react';\r\nimport { useNavigation } from '../../context/NavigationContext';\r\nimport { useAudio } from '../../context/AudioContext';\r\n\r\nconst CommandPalette = () => {\r\n    const { modals, closeModal, navigate, switchPracticeTab, openModal, addToHistory } = useNavigation();\r\n    const { toggleAudio, isAudioActive } = useAudio();\r\n    const [query, setQuery] = useState('');\r\n    const [selectedIndex, setSelectedIndex] = useState(0);\r\n    const inputRef = useRef(null);\r\n\r\n    const isOpen = modals.commandPalette;\r\n\r\n    // Focus input when opened\r\n    useEffect(() => {\r\n        if (isOpen && inputRef.current) {\r\n            inputRef.current.focus();\r\n            setQuery('');\r\n            setSelectedIndex(0);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    // Define Actions\r\n    const actions = [\r\n        {\r\n            id: 'practice-mic',\r\n            label: isAudioActive ? 'Stop Microphone' : 'Start Microphone',\r\n            icon: Mic,\r\n            category: 'Quick Actions',\r\n            action: () => { toggleAudio(); navigate('practice'); }\r\n        },\r\n        {\r\n            id: 'nav-practice',\r\n            label: 'Go to Practice Mode',\r\n            icon: Activity,\r\n            category: 'Navigation',\r\n            action: () => { navigate('practice'); addToHistory('Practice', () => navigate('practice')); }\r\n        },\r\n        {\r\n            id: 'nav-history',\r\n            label: 'Go to History',\r\n            icon: Book,\r\n            category: 'Navigation',\r\n            action: () => { navigate('history'); addToHistory('History', () => navigate('history')); }\r\n        },\r\n        {\r\n            id: 'nav-settings',\r\n            label: 'Open Settings',\r\n            icon: Settings,\r\n            category: 'Navigation',\r\n            action: () => openModal('settings')\r\n        },\r\n        {\r\n            id: 'view-pitch',\r\n            label: 'View Pitch Visualizer',\r\n            icon: Activity,\r\n            category: 'Tools',\r\n            action: () => { navigate('practice'); switchPracticeTab('pitch'); addToHistory('Pitch Tool', () => { navigate('practice'); switchPracticeTab('pitch'); }); }\r\n        },\r\n        {\r\n            id: 'view-spectrogram',\r\n            label: 'View Spectrogram',\r\n            icon: Activity,\r\n            category: 'Tools',\r\n            action: () => { navigate('practice'); switchPracticeTab('spectrogram'); addToHistory('Spectrogram', () => { navigate('practice'); switchPracticeTab('spectrogram'); }); }\r\n        },\r\n        {\r\n            id: 'view-vowel',\r\n            label: 'View Vowel Space',\r\n            icon: LayoutGrid,\r\n            category: 'Tools',\r\n            action: () => { navigate('practice'); switchPracticeTab('vowel'); addToHistory('Vowel Space', () => { navigate('practice'); switchPracticeTab('vowel'); }); }\r\n        },\r\n        {\r\n            id: 'modal-warmup',\r\n            label: 'Start Warm-up',\r\n            icon: Command,\r\n            category: 'Exercises',\r\n            action: () => openModal('warmup')\r\n        },\r\n        {\r\n            id: 'modal-assessment',\r\n            label: 'Take Assessment',\r\n            icon: Command,\r\n            category: 'Exercises',\r\n            action: () => openModal('assessment')\r\n        },\r\n        {\r\n            id: 'modal-practice-cards',\r\n            label: 'Open Practice Cards',\r\n            icon: Book,\r\n            category: 'Exercises',\r\n            action: () => openModal('practiceCards')\r\n        }\r\n    ];\r\n\r\n    // Filter Actions\r\n    const filteredActions = actions.filter(action =>\r\n        action.label.toLowerCase().includes(query.toLowerCase()) ||\r\n        action.category.toLowerCase().includes(query.toLowerCase())\r\n    );\r\n\r\n    const handleSelect = useCallback((action) => {\r\n        action.action();\r\n        closeModal('commandPalette');\r\n    }, [closeModal]);\r\n\r\n    // Handle Keyboard Navigation\r\n    useEffect(() => {\r\n        const handleKeyDown = (e) => {\r\n            if (!isOpen) return;\r\n\r\n            if (e.key === 'ArrowDown') {\r\n                e.preventDefault();\r\n                setSelectedIndex(prev => (prev + 1) % filteredActions.length);\r\n            } else if (e.key === 'ArrowUp') {\r\n                e.preventDefault();\r\n                setSelectedIndex(prev => (prev - 1 + filteredActions.length) % filteredActions.length);\r\n            } else if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                if (filteredActions[selectedIndex]) {\r\n                    handleSelect(filteredActions[selectedIndex]);\r\n                }\r\n            } else if (e.key === 'Escape') {\r\n                closeModal('commandPalette');\r\n            }\r\n        };\r\n\r\n        window.addEventListener('keydown', handleKeyDown);\r\n        return () => window.removeEventListener('keydown', handleKeyDown);\r\n    }, [isOpen, filteredActions, selectedIndex, closeModal, handleSelect]);\r\n\r\n                    if (!isOpen) return null;\r\n\r\n                    return createPortal(\r\n                        <div className=\"fixed inset-0 z-[1000] flex items-start justify-center pt-[20vh] px-4\">\r\n                            {/* Backdrop */}\r\n                            <div\r\n                                className=\"absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\"\r\n                                onClick={() => closeModal('commandPalette')}\r\n                            />\r\n\r\n                            {/* Palette */}\r\n                            <div className=\"w-full max-w-2xl bg-slate-900 border border-slate-700 rounded-xl shadow-2xl overflow-hidden relative z-10 animate-in zoom-in-95 duration-200 flex flex-col max-h-[60vh]\">\r\n                                {/* Search Input */}\r\n                                <div className=\"flex items-center px-4 py-4 border-b border-slate-800 gap-3\">\r\n                                    <Search className=\"text-slate-400 w-5 h-5\" />\r\n                                    <input\r\n                                        ref={inputRef}\r\n                                        type=\"text\"\r\n                                        placeholder=\"Type a command or search...\"\r\n                                        className=\"flex-1 bg-transparent border-none outline-none text-white placeholder:text-slate-500 text-lg\"\r\n                                        value={query}\r\n                                        onChange={(e) => { setQuery(e.target.value); setSelectedIndex(0); }}\r\n                                    />\r\n                                    <div className=\"hidden sm:flex items-center gap-1\">\r\n                                        <kbd className=\"px-2 py-1 bg-slate-800 rounded text-xs text-slate-400 font-mono\">ESC</kbd>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Results List */}\r\n                                <div className=\"overflow-y-auto custom-scrollbar p-2\">\r\n                                    {filteredActions.length === 0 ? (\r\n                                        <div className=\"p-8 text-center text-slate-500\">\r\n                                            No results found.\r\n                                        </div>\r\n                                    ) : (\r\n                                        <div className=\"space-y-1\">\r\n                                            {filteredActions.map((action, index) => (\r\n                                                <button\r\n                                                    key={action.id}\r\n                                                    onClick={() => handleSelect(action)}\r\n                                                    className={`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-colors text-left group ${index === selectedIndex ? 'bg-blue-600 text-white' : 'text-slate-300 hover:bg-slate-800'\r\n                                                        }`}\r\n                                                    onMouseEnter={() => setSelectedIndex(index)}\r\n                                                >\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className={`p-2 rounded-lg ${index === selectedIndex ? 'bg-white/20' : 'bg-slate-800 group-hover:bg-slate-700'}`}>\r\n                                                            <action.icon size={18} />\r\n                                                        </div>\r\n                                                        <div>\r\n                                                            <div className={`font-medium ${index === selectedIndex ? 'text-white' : 'text-slate-200'}`}>\r\n                                                                {action.label}\r\n                                                            </div>\r\n                                                            <div className={`text-xs ${index === selectedIndex ? 'text-blue-200' : 'text-slate-500'}`}>\r\n                                                                {action.category}\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </div>\r\n                                                    {index === selectedIndex && (\r\n                                                        <ArrowRight size={16} className=\"animate-in slide-in-from-left-2 fade-in\" />\r\n                                                    )}\r\n                                                </button>\r\n                                            ))}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Footer */}\r\n                                <div className=\"px-4 py-2 bg-slate-950/50 border-t border-slate-800 text-xs text-slate-500 flex justify-between\">\r\n                                    <span>Use <kbd className=\"font-mono\">Î“Ã¥Ã¦</kbd> to navigate</span>\r\n                                    <span><kbd className=\"font-mono\">Î“Ã¥â•¡</kbd> to select</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>,\r\n                        document.body\r\n                    );\r\n                };\r\n\r\n                export default CommandPalette;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\riley\\Desktop\\GEM\\src\\components\\ui\\GuidedJourney.jsx","messages":[{"ruleId":null,"fatal":true,"severity":2,"message":"Parsing error: Identifier 'getJourneyData' has already been declared","line":19,"column":9,"nodeType":null}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":1,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback } from 'react';\r\nimport { ArrowLeft, ArrowRight, X, Home, RotateCcw, CheckCircle } from 'lucide-react';\r\nimport { useGuidedJourney } from '../../context/GuidedJourneyContext';\r\nimport JourneyStep from './JourneyStep';\r\nimport JourneyProgressBar from './JourneyProgressBar';\r\n\r\n/**\r\n * GuidedJourney - Main container for the guided voice training experience\r\n * A full-screen, immersive coaching journey that takes users step-by-step\r\n */\r\nconst GuidedJourney = ({ onClose }) => {\r\n    const {\r\n        currentJourneyId,\r\n        currentStepIndex,\r\n        completedSteps,\r\n        isJourneyComplete,\r\n        getCurrentStep,\r\n        getJourneyData,\r\n        getJourneyData,\r\n        startJourney,\r\n        advanceStep,\r\n        goToPreviousStep,\r\n        goToStep,\r\n        completeStep,\r\n        exitJourney,\r\n        resetJourney\r\n    } = useGuidedJourney();\r\n\r\n    const [showExitConfirm, setShowExitConfirm] = useState(false);\r\n    const [showCompletionScreen, setShowCompletionScreen] = useState(false);\r\n    const [isTransitioning, setIsTransitioning] = useState(false);\r\n\r\n    const journeyData = getJourneyData(currentJourneyId || 'fem-journey');\r\n    const currentStep = getCurrentStep();\r\n\r\n    // Start journey if not already started\r\n    useEffect(() => {\r\n        if (!currentJourneyId) {\r\n            startJourney('fem-journey');\r\n        }\r\n    }, [currentJourneyId, startJourney]);\r\n\r\n    // Handle step completion and advancement\r\n    const handleNext = useCallback(() => {\r\n        if (!currentStep) return;\r\n\r\n        setIsTransitioning(true);\r\n\r\n        // Mark current step as complete\r\n        completeStep(currentStep.id);\r\n\r\n        // Advance to next step\r\n        const result = advanceStep();\r\n\r\n        if (result === 'complete') {\r\n            // Journey complete!\r\n            setShowCompletionScreen(true);\r\n        }\r\n\r\n        // Reset transition after animation\r\n        setTimeout(() => setIsTransitioning(false), 300);\r\n    }, [currentStep, completeStep, advanceStep]);\r\n\r\n    // Handle going back\r\n    const handlePrevious = useCallback(() => {\r\n        setIsTransitioning(true);\r\n        goToPreviousStep();\r\n        setTimeout(() => setIsTransitioning(false), 300);\r\n    }, [goToPreviousStep]);\r\n\r\n\r\n\r\n    // Handle exit\r\n    const handleExit = useCallback(() => {\r\n        exitJourney();\r\n        onClose();\r\n    }, [exitJourney, onClose]);\r\n\r\n    // Handle restart\r\n    const handleRestart = useCallback(() => {\r\n        resetJourney();\r\n        startJourney('fem-journey');\r\n        setShowCompletionScreen(false);\r\n    }, [resetJourney, startJourney]);\r\n\r\n    // Determine navigation state\r\n    const canGoBack = currentStepIndex > 0;\r\n    const isLastStep = currentStep?.final === true;\r\n\r\n    // Completion screen\r\n    if (showCompletionScreen || isJourneyComplete) {\r\n        return (\r\n            <div className=\"fixed inset-0 z-[100] bg-black flex flex-col animate-in fade-in duration-500\">\r\n                {/* Celebration background */}\r\n                <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\r\n                    <div className=\"absolute top-1/4 left-1/4 w-96 h-96 bg-pink-500/10 rounded-full blur-[100px] animate-pulse\" />\r\n                    <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/10 rounded-full blur-[100px] animate-pulse\" style={{ animationDelay: '1s' }} />\r\n                </div>\r\n\r\n                <div className=\"flex-1 flex items-center justify-center p-8\">\r\n                    <div className=\"max-w-lg text-center relative z-10\">\r\n                        {/* Celebration emoji */}\r\n                        <div className=\"text-8xl mb-6 animate-bounce\">ðŸŽ‰</div>\r\n\r\n                        <h1 className=\"text-4xl font-bold text-white mb-4\">\r\n                            Journey Complete!\r\n                        </h1>\r\n\r\n                        <p className=\"text-xl text-slate-300 mb-8\">\r\n                            You&apos;ve completed all 12 steps of the Voice Feminization Journey.\r\n                            This is just the beginning of your transformation!\r\n                        </p>\r\n\r\n                        {/* Stats */}\r\n                        <div className=\"grid grid-cols-2 gap-4 mb-8\">\r\n                            <div className=\"bg-slate-800/50 rounded-xl p-4 border border-white/5\">\r\n                                <div className=\"text-3xl font-bold text-pink-400\">12</div>\r\n                                <div className=\"text-sm text-slate-400\">Steps Completed</div>\r\n                            </div>\r\n                            <div className=\"bg-slate-800/50 rounded-xl p-4 border border-white/5\">\r\n                                <div className=\"text-3xl font-bold text-purple-400\">100%</div>\r\n                                <div className=\"text-sm text-slate-400\">Progress</div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Next steps */}\r\n                        <div className=\"bg-slate-900/50 rounded-xl p-6 border border-white/10 mb-8 text-left\">\r\n                            <h3 className=\"font-bold text-white mb-3 flex items-center gap-2\">\r\n                                <CheckCircle className=\"w-5 h-5 text-green-400\" />\r\n                                What&apos;s Next?\r\n                            </h3>\r\n                            <ul className=\"space-y-2 text-sm text-slate-300\">\r\n                                <li>â€¢ Practice daily with the Voice Analysis tools</li>\r\n                                <li>â€¢ Use Training Gym for targeted exercises</li>\r\n                                <li>â€¢ Track your progress over time</li>\r\n                                <li>â€¢ Revisit the journey anytime to refresh</li>\r\n                            </ul>\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"flex gap-4 justify-center\">\r\n                            <button\r\n                                onClick={handleRestart}\r\n                                className=\"flex items-center gap-2 px-6 py-3 bg-slate-800 hover:bg-slate-700 rounded-xl text-slate-300 font-bold transition-colors\"\r\n                            >\r\n                                <RotateCcw size={18} />\r\n                                Start Over\r\n                            </button>\r\n                            <button\r\n                                onClick={handleExit}\r\n                                className=\"flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 rounded-xl text-white font-bold shadow-lg shadow-pink-500/20 transition-all\"\r\n                            >\r\n                                <Home size={18} />\r\n                                Go to Dashboard\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Exit confirmation overlay\r\n    const renderExitConfirm = () => (\r\n        <div className=\"fixed inset-0 z-[110] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200\">\r\n            <div className=\"bg-slate-900 rounded-2xl border border-white/10 p-6 max-w-sm w-full shadow-2xl animate-in zoom-in-95 duration-200\">\r\n                <h3 className=\"text-xl font-bold text-white mb-2\">Exit Journey?</h3>\r\n                <p className=\"text-slate-400 text-sm mb-6\">\r\n                    Your progress will be saved. You can continue where you left off anytime.\r\n                </p>\r\n                <div className=\"flex gap-3\">\r\n                    <button\r\n                        onClick={() => setShowExitConfirm(false)}\r\n                        className=\"flex-1 px-4 py-2 bg-slate-800 hover:bg-slate-700 rounded-xl text-slate-300 font-bold transition-colors\"\r\n                    >\r\n                        Stay\r\n                    </button>\r\n                    <button\r\n                        onClick={handleExit}\r\n                        className=\"flex-1 px-4 py-2 bg-red-500/20 hover:bg-red-500/30 rounded-xl text-red-400 font-bold transition-colors\"\r\n                    >\r\n                        Exit\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n\r\n    if (!journeyData || !currentStep) {\r\n        return (\r\n            <div className=\"fixed inset-0 z-[100] bg-black flex items-center justify-center\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"animate-spin w-8 h-8 border-2 border-pink-500 border-t-transparent rounded-full mx-auto mb-4\" />\r\n                    <p className=\"text-slate-400\">Loading journey...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] bg-black flex flex-col animate-in fade-in duration-300\">\r\n            {/* Header */}\r\n            <header className=\"flex-shrink-0 p-4 border-b border-white/10 bg-slate-950/90 backdrop-blur-xl\">\r\n                <div className=\"max-w-5xl mx-auto flex items-center gap-4\">\r\n                    {/* Exit button */}\r\n                    <button\r\n                        onClick={() => setShowExitConfirm(true)}\r\n                        className=\"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white\"\r\n                        title=\"Exit Journey\"\r\n                    >\r\n                        <X size={20} />\r\n                    </button>\r\n\r\n                    {/* Journey title */}\r\n                    <div className=\"flex-1 min-w-0\">\r\n                        <h1 className=\"text-sm font-bold text-pink-400 uppercase tracking-wider truncate\">\r\n                            {journeyData.title}\r\n                        </h1>\r\n                        <p className=\"text-white font-bold truncate\">{currentStep.title}</p>\r\n                    </div>\r\n\r\n                    {/* Progress indicator */}\r\n                    <JourneyProgressBar\r\n                        steps={journeyData.steps}\r\n                        currentStepIndex={currentStepIndex}\r\n                        completedSteps={completedSteps}\r\n                        compact={true}\r\n                    />\r\n                </div>\r\n            </header>\r\n\r\n            {/* Main content area */}\r\n            <main className=\"flex-1 overflow-hidden\">\r\n                <div className=\"h-full max-w-4xl mx-auto p-6 lg:p-8\">\r\n                    <div\r\n                        className={`h-full transition-all duration-300 ${isTransitioning ? 'opacity-50 translate-x-4' : 'opacity-100 translate-x-0'\r\n                            }`}\r\n                    >\r\n                        <JourneyStep\r\n                            step={currentStep}\r\n                            onComplete={() => completeStep(currentStep.id)}\r\n                            isCompleted={completedSteps.includes(currentStep.id)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n            </main>\r\n\r\n            {/* Footer navigation */}\r\n            <footer className=\"flex-shrink-0 p-4 border-t border-white/10 bg-slate-950/90 backdrop-blur-xl\">\r\n                <div className=\"max-w-4xl mx-auto flex items-center justify-between\">\r\n                    {/* Back button */}\r\n                    <button\r\n                        onClick={handlePrevious}\r\n                        disabled={!canGoBack}\r\n                        className={`flex items-center gap-2 px-4 py-2 rounded-xl font-bold transition-all ${canGoBack\r\n                            ? 'text-slate-300 hover:text-white hover:bg-white/10'\r\n                            : 'text-slate-600 cursor-not-allowed'\r\n                            }`}\r\n                    >\r\n                        <ArrowLeft size={18} />\r\n                        <span className=\"hidden sm:inline\">Previous</span>\r\n                    </button>\r\n\r\n                    {/* Step counter */}\r\n                    <div className=\"text-center\">\r\n                        <span className=\"text-slate-400 text-sm\">\r\n                            Step <span className=\"text-white font-bold\">{currentStepIndex + 1}</span> of{' '}\r\n                            <span className=\"text-white\">{journeyData.steps.length}</span>\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Next button */}\r\n                    <button\r\n                        onClick={handleNext}\r\n                        className={`flex items-center gap-2 px-6 py-3 rounded-xl font-bold shadow-lg transition-all transform active:scale-95 ${isLastStep\r\n                            ? 'bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white shadow-green-500/20'\r\n                            : 'bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white shadow-pink-500/20'\r\n                            }`}\r\n                    >\r\n                        <span>{isLastStep ? 'Complete Journey' : 'Continue'}</span>\r\n                        {isLastStep ? (\r\n                            <CheckCircle size={18} />\r\n                        ) : (\r\n                            <ArrowRight size={18} />\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            </footer>\r\n\r\n            {/* Exit confirmation modal */}\r\n            {showExitConfirm && renderExitConfirm()}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default GuidedJourney;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\riley\\Desktop\\GEM\\src\\components\\ui\\IntonationCurveModule.jsx","messages":[{"ruleId":"no-undef","severity":2,"message":"'useCallback' is not defined.","line":109,"column":18,"nodeType":"Identifier","messageId":"undef","endLine":109,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { Play, Activity, HelpCircle, RefreshCw } from 'lucide-react';\r\nimport { INTONATION_PATTERNS } from '../../data/IntonationPatterns';\r\nimport { BiofeedbackService } from '../../services/BiofeedbackService';\r\n\r\nconst IntonationCurveModule = ({ audioEngine }) => {\r\n    const [selectedPattern, setSelectedPattern] = useState(INTONATION_PATTERNS[0]);\r\n    const [isRecording, setIsRecording] = useState(false);\r\n    const [status, setStatus] = useState('idle'); // idle, recording, analyzing, complete\r\n    const [userTrace, setUserTrace] = useState([]); // Array of {t, v}\r\n    const [score, setScore] = useState(null); // 0-100\r\n\r\n    const canvasRef = useRef(null);\r\n    const requestRef = useRef(null);\r\n    const startTimeRef = useRef(0);\r\n\r\n    const startRecording = () => {\r\n        setIsRecording(true);\r\n        setStatus('recording');\r\n        setUserTrace([]);\r\n        setScore(null);\r\n        startTimeRef.current = Date.now();\r\n\r\n        requestRef.current = requestAnimationFrame(animateLoop);\r\n\r\n        // Auto stop after duration\r\n        setTimeout(() => {\r\n            if (isRecording) stopRecording();\r\n        }, selectedPattern.duration);\r\n    };\r\n\r\n    const stopRecording = () => {\r\n        setIsRecording(false);\r\n        if (requestRef.current) cancelAnimationFrame(requestRef.current);\r\n\r\n        setStatus('analyzing');\r\n\r\n        // Calculate Score\r\n        // We need to pass the full arrays. Re-use userTrace state if updated or pull from ref if needed.\r\n        // Actually state updates might lag, let's assume valid data in userTrace by next render or use a Ref for trace data.\r\n        // For simplicity, we'll wait for the state update or just trust the animation loop pushed enough data.\r\n\r\n        // Wait a tick for state to settle? Or just calculate now with valid data.\r\n        // Let's use a temp variable in animation loop for robust calculation or use a Ref for the trace.\r\n    };\r\n\r\n    // Use a ref for trace to avoid closure staleness in animation loop\r\n    const traceRef = useRef([]);\r\n\r\n    useEffect(() => {\r\n        traceRef.current = userTrace;\r\n    }, [userTrace]);\r\n\r\n    // Handle Stop logic properly\r\n    useEffect(() => {\r\n        if (status === 'analyzing') {\r\n            const finalTrace = traceRef.current;\r\n            if (finalTrace.length > 5) {\r\n                // Normalize target for scoring? \r\n                // BiofeedbackService.calculateCurveScore expects normalized arrays.\r\n                // Our target points are already normalized {t:0..1, v:0..1}\r\n                // Our user points are {t:0..1, v:0..1} (calculated in animateLoop)\r\n                const calculatedScore = BiofeedbackService.calculateCurveScore(finalTrace, selectedPattern.points);\r\n                setScore(calculatedScore);\r\n                setStatus('complete');\r\n            } else {\r\n                setScore(0);\r\n                setStatus('complete');\r\n            }\r\n            setIsRecording(false);\r\n        }\r\n    }, [status, selectedPattern.points]);\r\n\r\n\r\n    const animateLoop = () => {\r\n        if (!audioEngine || !canvasRef.current) return;\r\n\r\n        const now = Date.now();\r\n        const elapsed = now - startTimeRef.current;\r\n        const progress = Math.min(1, elapsed / selectedPattern.duration);\r\n\r\n        if (progress >= 1) {\r\n            stopRecording();\r\n            return;\r\n        }\r\n\r\n        const data = audioEngine.getAnalysisData();\r\n        const pitch = data?.pitch || audioEngine.dataRef?.current?.pitch || 0;\r\n\r\n        // Normalize pitch: assume range 100Hz - 300Hz for visualization (can be adjusted per gender profile)\r\n        // 0 = 100Hz, 1 = 300Hz\r\n        let normalizedPitch = (pitch - 100) / 200;\r\n        normalizedPitch = Math.max(0, Math.min(1, normalizedPitch));\r\n\r\n        if (pitch > 50) {\r\n            // Add to trace\r\n            traceRef.current.push({ t: progress, v: normalizedPitch });\r\n            // Sync with state for basic reactivity if needed, but throttle it?\r\n            // Actually, setting state every frame is bad. Let's only set state at end or rely on Ref for drawing?\r\n            // We need to draw every frame.\r\n        }\r\n\r\n        draw(progress, traceRef.current);\r\n\r\n        requestRef.current = requestAnimationFrame(animateLoop);\r\n    };\r\n\r\n    const draw = useCallback((progress, currentTrace) => {\r\n        const canvas = canvasRef.current;\r\n        if (!canvas) return; // Guard clause\r\n        const ctx = canvas.getContext('2d');\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n\r\n        ctx.clearRect(0, 0, width, height);\r\n\r\n        // Background Grid\r\n        ctx.strokeStyle = '#1e293b'; // Slate-800\r\n        ctx.lineWidth = 1;\r\n        ctx.beginPath();\r\n        ctx.moveTo(0, height * 0.5); ctx.lineTo(width, height * 0.5); // Center line\r\n        ctx.stroke();\r\n\r\n        // Draw Target Curve\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = '#64748b'; // Slate-500\r\n        ctx.lineWidth = 4;\r\n        ctx.setLineDash([5, 5]);\r\n\r\n        selectedPattern.points.forEach((pt, i) => {\r\n            const x = pt.t * width;\r\n            const y = height - (pt.v * height); // Invert Y because canvas 0 is top\r\n            if (i === 0) ctx.moveTo(x, y);\r\n            else ctx.lineTo(x, y);\r\n        });\r\n        ctx.stroke();\r\n        ctx.setLineDash([]);\r\n\r\n        // Draw User Trace\r\n        if (currentTrace && currentTrace.length > 0) {\r\n            ctx.beginPath();\r\n            ctx.strokeStyle = '#3b82f6'; // Blue-500\r\n            ctx.lineWidth = 3;\r\n            ctx.lineCap = 'round';\r\n\r\n            currentTrace.forEach((pt, i) => {\r\n                const x = pt.t * width;\r\n                const y = height - (pt.v * height);\r\n                if (i === 0) ctx.moveTo(x, y);\r\n                else ctx.lineTo(x, y);\r\n            });\r\n            ctx.stroke();\r\n        }\r\n\r\n        // Draw Playhead\r\n        const playheadX = progress * width;\r\n        ctx.beginPath();\r\n        ctx.strokeStyle = '#ef4444'; // Red-500\r\n        ctx.lineWidth = 2;\r\n        ctx.moveTo(playheadX, 0);\r\n        ctx.lineTo(playheadX, height);\r\n        ctx.stroke();\r\n    }, [selectedPattern]);\r\n\r\n    // Initial draw\r\n    useEffect(() => {\r\n        if (canvasRef.current) {\r\n            draw(0, []);\r\n        }\r\n    }, [draw, selectedPattern]);\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center justify-between p-4 bg-slate-800/50 rounded-xl border border-white/5\">\r\n                <div>\r\n                    <h3 className=\"text-lg font-bold text-white flex items-center gap-2\">\r\n                        <Activity className=\"text-purple-400\" /> Intonation Tracing\r\n                    </h3>\r\n                    <p className=\"text-sm text-slate-400\">Mimic the speech pattern displayed.</p>\r\n                </div>\r\n                {(status === 'complete' || score !== null) && (\r\n                    <div className=\"text-right animate-in fade-in zoom-in\">\r\n                        <div className={`text-2xl font-bold font-mono ${score >= 80 ? 'text-emerald-400' : score >= 50 ? 'text-yellow-400' : 'text-slate-400'}`}>\r\n                            {score !== null ? `${score}%` : '--'}\r\n                        </div>\r\n                        <div className=\"text-xs text-slate-500 uppercase tracking-wider\">Accuracy</div>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                <div className=\"space-y-3\">\r\n                    <label className=\"text-xs font-bold text-slate-500 uppercase\">Select Pattern</label>\r\n                    <div className=\"space-y-2\">\r\n                        {INTONATION_PATTERNS.map(p => (\r\n                            <button\r\n                                key={p.id}\r\n                                onClick={() => {\r\n                                    if (!isRecording) {\r\n                                        setSelectedPattern(p);\r\n                                        setScore(null);\r\n                                        setStatus('idle');\r\n                                    }\r\n                                }}\r\n                                disabled={isRecording}\r\n                                className={`w-full text-left p-3 rounded-xl border transition-all ${selectedPattern.id === p.id ? 'bg-purple-900/20 border-purple-500/50 ring-1 ring-purple-500/30' : 'bg-slate-800 border-slate-700 hover:border-slate-600'} ${isRecording ? 'opacity-50 cursor-not-allowed' : ''}`}\r\n                            >\r\n                                <div className=\"flex justify-between items-center mb-1\">\r\n                                    <span className={`font-bold text-sm ${selectedPattern.id === p.id ? 'text-purple-300' : 'text-slate-300'}`}>{p.name}</span>\r\n                                    <span className={`text-[10px] px-2 py-0.5 rounded-full ${p.difficulty === 'Easy' ? 'bg-emerald-500/10 text-emerald-400' : p.difficulty === 'Medium' ? 'bg-yellow-500/10 text-yellow-400' : 'bg-red-500/10 text-red-400'}`}>\r\n                                        {p.difficulty}\r\n                                    </span>\r\n                                </div>\r\n                                <div className=\"text-xs text-slate-500 line-clamp-2\">{p.description}</div>\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"md:col-span-2 flex flex-col\">\r\n                    <div className=\"bg-slate-900 rounded-xl border border-slate-800 p-4 relative flex-1 min-h-[300px]\">\r\n                        <canvas\r\n                            ref={canvasRef}\r\n                            width={600}\r\n                            height={300}\r\n                            className=\"w-full h-full bg-slate-900 rounded-lg\"\r\n                        />\r\n\r\n                        {/* Overlay Controls */}\r\n                        {!isRecording && status !== 'recording' && (\r\n                            <div className=\"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-[1px] rounded-xl\">\r\n                                <button\r\n                                    onClick={startRecording}\r\n                                    className=\"px-8 py-4 bg-purple-600 hover:bg-purple-500 text-white rounded-full font-bold text-lg shadow-xl shadow-purple-900/30 flex items-center gap-3 transition-transform hover:scale-105 active:scale-95\"\r\n                                >\r\n                                    {status === 'complete' ? <RefreshCw size={20} /> : <Play size={20} fill=\"currentColor\" />}\r\n                                    {status === 'complete' ? 'Try Again' : 'Start Recording'}\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Recording Indicator */}\r\n                        {isRecording && (\r\n                            <div className=\"absolute top-4 right-4 flex items-center gap-2 px-3 py-1 bg-red-500/10 border border-red-500/20 rounded-full text-red-400 text-xs font-bold animate-pulse\">\r\n                                <div className=\"w-2 h-2 bg-red-400 rounded-full\" />\r\n                                Recording...\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"mt-4 p-4 bg-blue-900/10 border border-blue-500/10 rounded-xl flex items-start gap-3\">\r\n                        <HelpCircle className=\"w-5 h-5 text-blue-400 shrink-0 mt-0.5\" />\r\n                        <div className=\"text-sm text-blue-200/80\">\r\n                            <strong>Tip:</strong> {selectedPattern.description} Try to match the dotted line closely.\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default IntonationCurveModule;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]